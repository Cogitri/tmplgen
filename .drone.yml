---
kind: pipeline
name: default

steps:
- name: submodules
  image: docker:git
  commands:
  - git submodule update --recursive --init
- name: test
  image: rust:latest
  commands:
  - export RUST_BACKTRACE=1
  - export GIT_AUTHOR_NAME="drone"
  - export GIT_AUTHOR_EMAIL="drone@exqa.de"
  - cargo build --verbose --all
  - cargo test --verbose --all
- name: generate-coverage
  image: tarpaulin:latest
  commands:
  - export GIT_AUTHOR_NAME="drone"
  - export GIT_AUTHOR_EMAIL="drone@exqa.de"
  - cargo tarpaulin --verbose --out Xml --timeout 300
- name: upload-coverage
  image: plugins/codecov
  settings:
    token:
      from_secret: codecov_token
      files:
      - cobertura.xml
      required: true
- name: bench
  image: rust:latest
  commands:
  - cargo bench
---
kind: signature
hmac: 621fef0b70ef70009070af2207d7953afea0cdae708c5e5daa64c079f925e941

...
